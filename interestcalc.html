<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savings Account Calculator</title>
    <meta name="description" content="Calculate the total value in a savings account with daily compounding interest. Enter your deposit details and get results instantly.">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
        }
        .content {
            max-width: 600px;
            margin: 10px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .form-group {
            margin: 15px auto;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="number"] {
            width: calc(100% - 10px);
            padding: 8px;
            margin: 0 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #007BFF;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        #results {
            max-width: 600px;
            margin: 20px auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: none;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
        .summary {
            margin-top: 20px;
        }
        .toggle-buttons {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Savings Account Calculator</h1>
    <div class="content">
        <p>This calculator helps you estimate the total value of a savings account with daily compounding interest. 
        Enter your initial and subsequent deposits along with the number of days for each. 
        Specify the total duration and annual interest rate to see the growth of your investments.</p>
    </div>
    <form id="savingsForm" class="content" aria-labelledby="formTitle">
        <div class="form-group">
            <label for="annualInterestRate">Annual Interest Rate (%):</label>
            <input type="number" step="0.01" id="annualInterestRate" required>
        </div>
        <div id="depositInputs">
            <div class="form-group">
                <label for="deposit1Amount">Deposit 1 Amount:</label>
                <input type="number" step="0.01" id="deposit1Amount" required>
                <label for="daysAfterPrevious1">Days after previous deposit (0 for first deposit):</label>
                <input type="number" id="daysAfterPrevious1" disabled value="0" required>
            </div>
        </div>
        <button type="button" onclick="addDeposit()">Add Another Deposit</button>
        <div class="form-group">
            <label for="totalDays">Total Days:</label>
            <input type="number" id="totalDays" required>
        </div>
        <button type="submit">Calculate</button>
        <div id="errorMessage" class="error" role="alert" aria-live="assertive"></div>
    </form>
    <div id="results">
        <h2>Results</h2>
        <div class="summary" id="summary"></div>
        <div class="toggle-buttons">
            <button onclick="showTable()">Show Table</button>
            <button onclick="showJSON()">Show JSON</button>
            <button onclick="downloadCSV()">Download as CSV</button>
        </div>
        <pre id="resultsContent"></pre>
        <table id="resultsTable"></table>
    </div>
    <script>
        let depositCount = 1;

        function addDeposit() {
            depositCount++;
            if (depositCount > 10) return;

            const depositInputs = document.getElementById('depositInputs');
            const formGroup = document.createElement('div');
            formGroup.classList.add('form-group');
            formGroup.innerHTML = `
                <label for="deposit${depositCount}Amount">Deposit ${depositCount} Amount:</label>
                <input type="number" step="0.01" id="deposit${depositCount}Amount" required>
                <label for="daysAfterPrevious${depositCount}">Days after previous deposit:</label>
                <input type="number" id="daysAfterPrevious${depositCount}" required>
            `;
            depositInputs.appendChild(formGroup);
        }

        function sanitizeInput(value) {
            return value.replace(/[^0-9.-]/g, '');
        }

        function validateInputs(deposits, totalDays, annualInterestRate) {
            const errorMessage = document.getElementById('errorMessage');
            if (isNaN(totalDays) || totalDays <= 0) {
                errorMessage.textContent = "Total Days must be a positive number.";
                return false;
            }
            if (isNaN(annualInterestRate) || annualInterestRate <= 0) {
                errorMessage.textContent = "Annual Interest Rate must be a positive number.";
                return false;
            }
            for (let i = 0; i < deposits.length; i++) {
                const [amount, daysAfterPrevious] = deposits[i];
                if (isNaN(amount) || amount <= 0 || isNaN(daysAfterPrevious) || daysAfterPrevious < 0) {
                    errorMessage.textContent = `Invalid input for Deposit ${i + 1}. Amount must be positive and Days must be non-negative.`;
                    return false;
                }
            }
            errorMessage.textContent = "";
            return true;
        }

        function calculateSavings(deposits, totalDays, annualInterestRate) {
            const compoundingPeriodsPerYear = 365;
            let totalAmount = 0;
            let initialTotal = 0;
            let contributions = [];

            deposits.forEach(deposit => {
                const [amount, daysAfterPrevious] = deposit;
                const daysInvested = totalDays - daysAfterPrevious;
                const finalAmount = amount * Math.pow(1 + annualInterestRate / compoundingPeriodsPerYear, daysInvested);
                totalAmount += finalAmount;
                initialTotal += amount;
                contributions.push({
                    initialAmount: amount,
                    finalAmount: finalAmount,
                    interestEarned: finalAmount - amount
                });
            });

            return {
                totalValue: totalAmount,
                initialTotal: initialTotal,
                totalInterestEarned: totalAmount - initialTotal,
                contributions: contributions
            };
        }

        function showTable() {
            document.getElementById('resultsTable').style.display = 'table';
            document.getElementById('resultsContent').style.display = 'none';
        }

        function showJSON() {
            document.getElementById('resultsTable').style.display = 'none';
            document.getElementById('resultsContent').style.display = 'block';
        }

        function downloadCSV() {
            const results = JSON.parse(document.getElementById('resultsContent').textContent);
            let csvContent = "Deposit Number,Initial Amount,Final Amount,Interest Earned\n";
            results.contributions.forEach((contribution, index) => {
                csvContent += `${index + 1},${contribution.initialAmount.toFixed(2)},${contribution.finalAmount.toFixed(2)},${contribution.interestEarned.toFixed(2)}\n`;
            });
            csvContent += `Total,,${results.totalValue.toFixed(2)},${results.totalInterestEarned.toFixed(2)}`;
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'savings_results.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        document.getElementById('savingsForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const annualInterestRate = parseFloat(sanitizeInput(document.getElementById('annualInterestRate').value)) / 100;
            const depositInputs = document.querySelectorAll('#depositInputs .form-group');
            const deposits = Array.from(depositInputs).map(group => [
                parseFloat(sanitizeInput(group.children[1].value)),
                parseInt(sanitizeInput(group.children[3].value))
            ]);
            const totalDays = parseInt(sanitizeInput(document.getElementById('totalDays').value));

            if (!validateInputs(deposits, totalDays, annualInterestRate)) {
                return;
            }

            const results = calculateSavings(deposits, totalDays, annualInterestRate);

            const summary = document.getElementById('summary');
            summary.innerHTML = `
                <p><strong>Total Initial Deposits:</strong> £${results.initialTotal.toFixed(2)}</p>
                <p><strong>Total Final Amount:</strong> £${results.totalValue.toFixed(2)}</p>
                <p><strong>Total Interest Earned:</strong> £${results.totalInterestEarned.toFixed(2)}</p>
            `;

            const resultsContent = document.getElementById('resultsContent');
            resultsContent.textContent = JSON.stringify(results, null, 2);

            const resultsTable = document.getElementById('resultsTable');
            resultsTable.innerHTML = `
                <tr>
                    <th>Deposit #</th>
                    <th>Initial Amount</th>
                    <th>Final Amount</th>
                    <th>Interest Earned</th>
                </tr>
            `;
            results.contributions.forEach((contribution, index) => {
                const row = resultsTable.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${contribution.initialAmount.toFixed(2)}</td>
                    <td>${contribution.finalAmount.toFixed(2)}</td>
                    <td>${contribution.interestEarned.toFixed(2)}</td>
                `;
            });

            document.getElementById('results').style.display = 'block';
            showTable(); // Default to table view
        });
    </script>
</body>
</html>
